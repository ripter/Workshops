pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- flappy chester
-- by chris richards


function _init()
	-- set inital animations
	anim_play(player.anim, "idle")
end

function _update()
	cls()
	player_update(player)
	anim_update(player.anim)
	
	wall_update(wall1)
	wall_update(wall2)
end

function _draw()
	-- draw the walls
	wall_draw(wall1)
	wall_draw(wall2)

	-- draw the player
	sprite(
		player.anim.sn, 
		player.x,
		player.y, 
		16, 16
	)
end

-->8
-- game state
high_score = 0
score = 0

player = {
	x=24,
	y=0,
	anim={},
	vel=0,
}

animations = {
	flap={2,0,4},
	idle={0},
}

wall1 = {
	enabled=true,
	x=70,
	mx=0,
}

wall2 = {
	enabled=false,
	x=70,
	mx=2,
}
-->8
-- animation system

-- sets/resets the animation.
function anim_play(self, name)
	self.frames = animations[name]
	self.delay = 4
	self.tick = self.delay
	self.index = 1
	self.sn = self.frames[self.index]
end


-- update the animation
function anim_update(self)
	self.tick -= 1
	
	-- when tick reaches 0
	-- update the frame index
	if self.tick == 0 then
		self.index += 1
		self.tick = self.delay
	end
	
	-- when we reach the last frame,
	-- loop back to the start.
	if self.index > #self.frames then
		self.index = 1
		-- revert back to idle
		self.frames = animations.idle
	end
	
	-- update the sprite number
	self.sn = self.frames[self.index]
end



-- draw a sprite by sprite number
function sprite(sn, x, y, w, h)
	local sn_x = (sn%32) * 8
	local sn_y = flr(sn/32) * w
	sspr(sn_x, sn_y, w, h, x, y)
end
-->8
-- player

function player_update(self)
	-- apply gravity
	self.vel += 0.3

	-- any button press for flap
 if btn() > 0 then
 	self.vel -= 1.6
 	anim_play(self.anim, "flap")
 end
 
 -- limit velocity
 if self.vel >= 2.0 then
 	self.vel = 2.0
 elseif self.vel <= -3.0 then
 	self.vel = -3.0
 end
 
 -- bounds check
 if self.vel > 0 
 	and self.y >= 128 then
 	self.vel = 0
 end
 
 -- update by velocity
 self.y += self.vel
end
-->8
-- wall

function wall_draw(self)
	if not self.enabled then
		return
	end
	map(self.mx,0, self.x,0, 2,32)
end

function wall_update(self)
	if not self.enabled then
		return
	end
	
	self.x -= 2.5
	
	if self.x <= -16 then
		self.x = 128
	end
end
__gfx__
99999999999999999999999999999999999999999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000
90000000000000099000000000000009900000000000000990000000000000090000000000000000000000000000000000000000000000000000000000000000
90000000000000099000000000000009900000000000000990000000000000090000000000000000000000000000000000000000000000000000000000000000
90000000000000099044400000000009900000000000000990000000000000090000000000000000000000000000000000000000000000000000000000000000
90000000000000099044440000000009900000000000000990000000000000090000000000000000000000000000000000000000000000000000000000000000
90888000000000099044444400000009908880000000000990888000000000090000000000000000000000000000000000000000000000000000000000000000
90800888880000099044444444400009908008888800000990800888880000090000000000000000000000000000000000000000000000000000000000000000
90444444444880099044444444488009904444444448800990444444442220090000000000000000000000000000000000000000000000000000000000000000
90800000008880099080000000888009904444444448800990800000022222090000000000000000000000000000000000000000000000000000000000000000
90800888880000099080088888000009904444444800000990800888220202290000000000000000000000000000000000000000000000000000000000000000
90888000000000099088800000000009904444440000000990888000222022290000000000000000000000000000000000000000000000000000000000000000
90000000000000099000000000000009904444000000000990000000220202290000000000000000000000000000000000000000000000000000000000000000
90000000000000099000000000000009904440000000000990000000022222090000000000000000000000000000000000000000000000000000000000000000
90000000000000099000000000000009900000000000000990000000002220090000000000000000000000000000000000000000000000000000000000000000
90000000000000099000000000000009900000000000000990000000000000090000000000000000000000000000000000000000000000000000000000000000
99999999999999999999999999999999999999999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b3bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b33333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b33333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3bbbbbbbbbb3b33333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
